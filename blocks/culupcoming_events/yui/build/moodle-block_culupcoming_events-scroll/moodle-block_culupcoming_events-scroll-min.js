YUI.add("moodle-block_culupcoming_events-scroll",function(s,e){M.block_culupcoming_events=M.block_culupcoming_events||{},M.block_culupcoming_events.scroll={lookahead:365,courseid:0,limitnum:null,scroller:null,reloader:null,timer:null,init:function(e){var l,o,i;s.one(".pages")&&s.one(".pages").hide();try{l=s.one(s.config.doc),o=s.one(".block_culupcoming_events .reload"),i=(i=s.one(".block_culupcoming_events").get("id")).replace("inst",""),s.one("#instance-"+i+"-header").append(o),o.setStyle("display","inline-block"),l.delegate("click",this.reloadblock,".block_culupcoming_events_reload",this)}catch(t){}this.scroller=s.one(".block_culupcoming_events .culupcoming_events"),this.scroller.on("scroll",this.filltobelowblock,this),this.lookahead=e.lookahead,this.courseid=e.courseid,this.limitnum=e.limitnum,this.timer=s.later(3e5,this,this.simulateclick,[],!0),this.filltobelowblock(),s.publish("culcourse-upcomingevents:reloadevents",{broadcast:2})},filltobelowblock:function(){var e,l,o,i,t=this.scroller.get("scrollHeight"),n=this.scroller.get("scrollTop"),c=this.scroller.get("clientHeight");t-(n+c)<10&&(this.timer.cancel(),l=0<(o=s.all(".block_culupcoming_events .culupcoming_events li.item").size())?(e=(i=s.all(".block_culupcoming_events .culupcoming_events li.item").item(o-1)).get("id").split("_")[0],i.get("id").split("_")[1]):e=0,this.addevents(o,e,l),this.timer=s.later(3e5,this,this.simulateclick,[],!0))},reloadblock:function(e){e.preventDefault(),this.reloadevents(e)},addevents:function(e,l,o){this.scroller.detach("scroll"),s.one(".block_culupcoming_events_reload").setStyle("display","none"),s.one(".block_culupcoming_events_loading").setStyle("display","inline-block");var i={sesskey:M.cfg.sesskey,lookahead:this.lookahead,courseid:this.courseid,lastid:l,limitnum:this.limitnum};s.io(M.cfg.wwwroot+"/blocks/culupcoming_events/scroll_ajax.php",{method:"POST",data:window.build_querystring(i),context:this,on:{success:function(e,l){var o=s.JSON.parse(l.responseText);o.error?this.timer.cancel():o.output&&s.one(".block_culupcoming_events .events").append(o.output),o.end||this.scroller.on("scroll",this.filltobelowblock,this),s.one(".block_culupcoming_events_loading").setStyle("display","none"),s.one(".block_culupcoming_events_reload").setStyle("display","inline-block")},failure:function(){s.one(".block_culupcoming_events_loading").setStyle("display","none"),s.one(".block_culupcoming_events_reload").setStyle("display","inline-block"),this.timer.cancel()}}})},reloadevents:function(){var e,l=s.all(".block_culupcoming_events .culupcoming_events li.item").size();l&&this.scroller.all("li.item").item(l-1).get("id").split("_")[0],s.one(".block_culupcoming_events_reload").setStyle("display","none"),s.one(".block_culupcoming_events_loading").setStyle("display","inline-block"),e={sesskey:M.cfg.sesskey,lookahead:this.lookahead,courseid:this.courseid,limitnum:this.limitnum},s.io(M.cfg.wwwroot+"/blocks/culupcoming_events/reload_ajax.php",{method:"POST",data:window.build_querystring(e),context:this,on:{success:function(e,l){var o=s.JSON.parse(l.responseText);o.error?this.timer.cancel():o.output&&s.one(".block_culupcoming_events .culupcoming_events .events").setHTML(o.output),s.one(".block_culupcoming_events_loading").setStyle("display","none"),s.one(".block_culupcoming_events_reload").setStyle("display","inline-block")},failure:function(){s.one(".block_culupcoming_events_loading").setStyle("display","none"),s.one(".block_culupcoming_events_reload").setStyle("display","inline-block"),this.timer.cancel()},end:function(){s.fire("culcourse-upcomingevents:reloadevents",{})}}})},simulateclick:function(){s.one(".block_culupcoming_events_reload").simulate("click")}}},"@VERSION@",{requires:["base","node","io","json-parse","dom-core","querystring","event-custom","moodle-core-dock","node-event-simulate"]});